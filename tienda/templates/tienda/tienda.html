{% extends 'bases/base.html' %}

{% load static %}

{% block btn_carrito%}
<li class="nav-item ">
  <a class="nav-link cl-white" aria-current="page" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight"
    aria-controls="offcanvasRight"><i class="fa-solid fa-cart-shopping fa-xl"></i></a>
</li>

{% endblock %}


{% block page_content %}




<div class=" row container-fluid">
  <div class="py-2">

  </div>
</div>

<div class="container">

  <div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-indicators">
      <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active"
        aria-current="true" aria-label="Slide 1"></button>
      <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1"
        aria-label="Slide 2"></button>
      <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2"
        aria-label="Slide 3"></button>
    </div>
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img src="{% static 'web/img/calamina_tradicional.jpg' %}" class="d-block w-100" alt="...">
        <div class="carousel-caption d-none d-md-block">
          <h5>Titulo del producto</h5>
          <p>Descripcion del producto</p>
        </div>
      </div>
      <div class="carousel-item">
        <img src="{% static 'web/img/calamina_blanca.jpg' %}" class="d-block w-100" alt="...">
        <div class="carousel-caption d-none d-md-block">
          <h5>Titulo del producto</h5>
          <p>Descripcion del producto</p>
        </div>
      </div>
      <div class="carousel-item">
        <img src="{% static 'web/img/calamina_plastica.jpg' %}" class="d-block w-100" alt="...">
        <div class="carousel-caption d-none d-md-block">
          <h5>Titulo del producto</h5>
          <p>Descripcion del producto</p>
        </div>
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>

</div>

<!-- Inicio Espacio en blanco -->
<div class=" row container-fluid">
  <div class="py-5">

  </div>
</div>

<!-- fin Espacio en blanco -->


<div class="container">




  <!-- <div class="d-flex justify-content-center align-items-center"> -->
  <div class=" row row-cols-1 row-cols-md-3 g-4  align-items-center" id="productos">



    {% for item in obj %}

    <div class="col " data-aos="zoom-in-down">
      <div class="card p-3 mx-1 hover-prod">
        <div class="card-img-top">
          <img src="/{{item.img}}" width="100%">
        </div>
        <div class="d-flex justify-content-between align-items-center ">
          <div class="mt-2">
            <h4 class="text-uppercase">{{item.nombre}}</h4>

          </div>

        </div>

        <p>{{item.descripcion}}</p>


        {% if item.flag_precio %}
        <p class="fw-bold text-end">{{item.precio}} Bs.</p>

        {% else %}

        <p class="fw-bold text-end"> {{item.p_inicial}} Bs - {{item.p_final}} Bs</p>

        {% endif %}


        <div class="text-end m-2" style="font-size: .8em;">
          <a href="{% url 'tienda:producto_id' item.pk %}">Ver producto</a>
        </div>

        <div class="btn-group" role="group" aria-label="Basic mixed styles example">

          <!-- <button type="button" class="btn btn-warning">Comprar</button> -->
          {% if item.flag_precio %}
          <button type="button" class="btn btn-success">Cotizar</button>

          <a href="{% url 'ecommerce:Add' item.id %}" class="btn btn-warning">Comprar</a>

          {% else  %}

          <button type="button" class="btn btn-success">Info. Ventas</button>


          {%  endif %}



          <a href="{{param.ptxt2}}{% url 'tienda:producto_id' item.pk %}" class="btn btn-outline-success"><i
            class="fa-brands fa-whatsapp"></i> Chat</a>

        </div>
      </div>
    </div>

    

    {% endfor%}




  </div>


</div>
<!-- fin de tienda  -->

<!-- fin Carrito -->



<!-- Inicio Espacio en blanco -->
<div class=" row container-fluid">
  <div class="py-5">

  </div>
</div>





<input type="hidden" name="inicio" id="inicio" value="{{inicio}}">
<input type="hidden" name="fin" id="fin" value="{{fin}}">



{% endblock %}

{% block js_page %}

<script src="{% static 'base/js/jquery.min.js'%}"></script>

<script>

$(window).scroll(function() {

  alturaTotalDocumento = $(document).height();
  alturaScroll = $(this).scrollTop();
  alturaViewPort = $(this).height();

  if (alturaTotalDocumento == (alturaScroll + alturaViewPort)){

    console.log("Se carga de nuevo");
    cargar_ventas();

  }


});



function cargar_ventas(id) {



//       $("#productos").append( '   <div class="col " data-aos="zoom-in-down">' +
//  '     <div class="card p-3 mx-1 hover-prod">' +
//  '       <div class="card-img-top">' +
//  '         <img src="{% static  "img/productos/producto_preba.jpg" %}" width="100%">' +
//  '       </div>' +
//  '       <div class="d-flex justify-content-between align-items-center ">' +
//  '         <div class="mt-2">' +
//  '           <h4 class="text-uppercase">Nombre de producto</h4>' +
//  '         </div>' +
//  '       </div>' +
//  '       <p>{{item.descripcion}}</p>' +
//  '       <p class="fw-bold text-end">1000 Bs.</p>' +
//  '       <div class="text-end m-2" style="font-size: .7em;">' +
//  '         <a href="{% url "tienda:producto_id" 1 %}">Ver producto</a>' +
//  '       </div>' +
//  '       <div class="btn-group" role="group" aria-label="Basic mixed styles example">' +
//  '         <!-- <button type="button" class="btn btn-warning">Comprar</button> -->' +
//  '         <button type="button" class="btn btn-success">Cotizar</button>' +
//  '         <a href="{% url "ecommerce:Add" 1 %}" class="btn btn-warning">Comprar</a>' +
//  '         <a href="{{param.ptxt2}}{% url "tienda:producto_id" 1 %}" class="btn btn-info">Comprar</a>' +
//  '       </div>' +
//  '     </div>' +
//  '   </div>' );


     var et_prod =  '   <div class="col " data-aos="zoom-in-down">' +
 '     <div class="card p-3 mx-1 hover-prod">' +
 '       <div class="card-img-top">' +
 '         <img src="/|img|" width="100%">' +
 '       </div>' +
 '       <div class="d-flex justify-content-between align-items-center ">' +
 '         <div class="mt-2">' +
 '           <h4 class="text-uppercase">|nombre_prod|</h4>' +
 '         </div>' +
 '       </div>' +
 '       <p>|desc|</p>' +
 '       <p class="fw-bold text-end">|precio| Bs.</p>' +
 '       <div class="text-end m-2" style="font-size: .7em;">' +
 '         <a href="/tienda/producto/|id|/">Ver producto</a>' +
 '       </div>' +
 '       <div class="btn-group" role="group" aria-label="Basic mixed styles example">' +
 '         <!-- <button type="button" class="btn btn-warning">Comprar</button> -->' +
 '         <button type="button" class="btn btn-success">Cotizar</button>' +
 '         <a href="{% url "ecommerce:Add" 1 %}" class="btn btn-warning">Comprar</a>' +
 '         <a href="{{param.ptxt2}}/tienda/producto/|id|/" class="btn btn-info">Comprar</a>' +
 '       </div>' +
 '     </div>' +
 '   </div>' ;


        // $("#carga").show()

        console.log($("#inicio").val())

        var data = {
            inicio: $("#inicio").val(),
            fin:$("#fin").val()

        };
        // data = JSON.stringify(data);
        var token = '{{csrf_token}}';
        // alert(token);
        // alert(id);
        console.log(data);

        $.ajax({
            headers: { "X-CSRFToken": token },
            type: "GET",
            url: "/tienda/tienda/loader",
            data: data,
            success: function (response) {
                $("#carga").hide()
                $("#no_info").hide()
                $("#info").show()

                if (response['state']=='OK'){
                  
                  
                  
                  console.log(response);
                  $("#inicio").val(response['inicio']);
                  $("#fin").val(response['fin']);


                  for(var i in response['list_data']){
                      console.log(i)
                      console.log(response['list_data'][i]['img'])

                      et_prod = et_prod.replace('|nombre_prod|',response['list_data'][i]['nombre']);
                      et_prod = et_prod.replace('|img|',response['list_data'][i]['img']);
                      et_prod = et_prod.replace('|precio|',response['list_data'][i]['precio']);
                      et_prod = et_prod.replace('|id|',response['list_data'][i]['id']);
                      et_prod = et_prod.replace('|id|',response['list_data'][i]['id']);
                      et_prod = et_prod.replace('|desc|',response['list_data'][i]['desc']);
                      $("#productos").append( et_prod);

                      aux = '';



                  }


                }

                // aux["order"][0].category

                // if (response['status'] == 'OK') {
                //     console.log(response['obj'])
                //     $("#paciente").text(response['obj']['paciente'])
                //     $("#edad").text(response['obj']['edad'] + " AÃ±os")
                //     $("#medico").text(response['obj']['medico'])
                //     $("#ultima_session").text(response['obj']['ultima_session'])
                //     $("#tiempo_pasado").text(response['obj']['tiempo_dif'])
                //     $("#proxima_session").text(response['obj']['proxima_session'] + '  ' + response['obj']['hora_proxima'] )
                //     // $("#proxima_hora").text()

                //     $("#especialidad").text(response['obj']['categoria'])
                //     $("#visitas").text(response['obj']['visitas'])




                // }

                //  aux = response;
                //  console.log(aux);
            },
            error: function (jqXHR, textStatus, errorThrow) {
                console.log(textStatus, errorThrow);
                mensaje(errorThrow, 'red');
                cerrar_modal();
            }
        });

    }


</script>


{% endblock %}